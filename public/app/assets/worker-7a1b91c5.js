function x(t,n){if(!t)throw Error(n??"AssertionError: condition was falsey")}function E(t){x(t.exports.memory instanceof WebAssembly.Memory),x(typeof t.exports.malloc=="function"),x(typeof t.exports.free=="function")}function A(t,n,e){const r=new Uint8Array(t.exports.memory.buffer.slice(n));let l=0;for(;l<r.byteLength&&r[l]!==0;++l);return S(t,n,l-1,e)}function S(t,n,e,r="utf8"){const l=t.exports.memory.buffer.slice(n,n+e);return{value:new TextDecoder(r).decode(l),ptr:n,len:e,free(){t.exports.free(this.ptr,this.len)}}}function D(t,n){const e=new TextEncoder().encode(n),r=t.exports.malloc(e.byteLength),l=new DataView(t.exports.memory.buffer,r,e.byteLength);for(let s=0;s<e.byteLength;++s)l.setUint8(s,e[s]);return S(t,r,e.byteLength)}function w(t,n,e,r="utf8"){return S(t,n,e,r)}function z(t){return E(t),{_instance:t,ptrToStr:(...n)=>A(t,...n),ptrAndLenToStr:(...n)=>S(t,...n),marshalString:(...n)=>D(t,...n),unmarshalString:(...n)=>w(t,...n),marshalSlice(n){throw Error("unimplemented")},unmarshalSlice(n,e="utf8"){const r=new DataView(t.exports.memory.buffer,n),l=r.getUint32(0,!0),s=r.getUint32(4,!0);return w(t,l,s,e)}}}var U=async(t={},n)=>{let e;if(n.startsWith("data:")){const r=n.replace(/^data:.*?base64,/,"");let l;if(typeof Buffer=="function"&&typeof Buffer.from=="function")l=Buffer.from(r,"base64");else if(typeof atob=="function"){const s=atob(r);l=new Uint8Array(s.length);for(let p=0;p<s.length;p++)l[p]=s.charCodeAt(p)}else throw new Error("Failed to decode base64-encoded data URL, Buffer and atob are not supported");e=await WebAssembly.instantiate(l,t)}else{const r=await fetch(n),l=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&l.startsWith("application/wasm"))e=await WebAssembly.instantiateStreaming(r,t);else{const s=await r.arrayBuffer();e=await WebAssembly.instantiate(s,t)}}return e.instance},M=t=>U(t,"/app/assets/alternis-9800d22e.wasm?init"),_;(t=>{const n=s=>({unmarshal(p,i){const o=[],d=i.getUint32(0,!0);if(d===0)return[];const c=i.getUint32(4,!0);for(let b=0;b<c;++b){const f=new DataView(i.buffer,d+b*s.byteSize);o.push(s.unmarshal(p,f))}return o},byteSize:8});let e;(s=>{function p(i,o){const d=o.getUint32(0,!0);if(d===0)return;const c=o.getUint32(4,!0);return w(i._instance,d,c)}s.unmarshal=p,s.byteSize=8})(e=t.StringSlice||(t.StringSlice={}));let r;(s=>{function p(i,o){const d=o.getUint32(0,!0);if(d===0)return;const c=o.getUint32(4,!0),b=[],f=4;for(let h=0;h<c;++h){const a=new DataView(o.buffer,d+h*f);b.push(a.getUint32(0,!0))}return b}s.unmarshal=p,s.byteSize=8})(r=t.USizeSlice||(t.USizeSlice={}));let l;(s=>{function p(i,o){const d=new DataView(o.buffer,o.byteOffset+0*e.byteSize),c=e.unmarshal(i,d);if(c===void 0)throw Error("speaker was null");const b=new DataView(o.buffer,o.byteOffset+1*e.byteSize),f=e.unmarshal(i,b);if(f===void 0)throw Error("text was null");const h=new DataView(o.buffer,o.byteOffset+2*e.byteSize),a=e.unmarshal(i,h);return{speaker:c.value,text:f.value,metadata:a==null?void 0:a.value}}s.unmarshal=p,s.byteSize=3*e.byteSize})(l=t.Line||(t.Line={})),(s=>{(i=>{i[i.Done=0]="Done",i[i.Options=1]="Options",i[i.Line=2]="Line",i[i.FunctionCalled=3]="FunctionCalled"})(s.Tag||(s.Tag={}));function p(i,o){const d=o.getUint8(0);if(d==0)return{done:!0};const c=new DataView(o.buffer,o.byteOffset+4,o.byteLength-4);if(d==1){const b=new DataView(o.buffer,c.byteOffset+0),f=n(l).unmarshal(i,b),h=new DataView(o.buffer,c.byteOffset+n(l).byteSize),a=r.unmarshal(i,h)??[];return{options:f.map((m,u)=>({...m,id:a[u]}))}}if(d==2)return{line:l.unmarshal(i,c)};if(d==3)return{functionCalled:!0};throw Error("unreachable; unknown tag while unmarshalling StepResult")}s.unmarshal=p,s.byteSize=4+l.byteSize})(t.StepResult||(t.StepResult={}))})(_||(_={}));let C,V;const L=new Map;async function k(){return C??(C=M({env:{_debug_print(t,n){console.log(w(V,t,n).value)},_call_js(t){const n=L.get(t);if(n===void 0)throw Error("no such handle!");n()}}}).then(t=>(V=t,z(t))))}async function v(t,n={}){const e=await k(),r=e.marshalString(t),l=n.randomSeed??BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)),s=n.noInterpolate??!1?1:0,p=e._instance.exports.malloc(4),i=()=>new DataView(e._instance.exports.memory.buffer,p);i().setUint32(0,0,!0);const o=e._instance.exports.malloc(_.StepResult.byteSize),d=()=>new DataView(e._instance.exports.memory.buffer,o),c=e._instance.exports.ade_dialogue_ctx_create_json(r.ptr,r.len,l,s,p),b=i().getUint32(0,!0);if(b!==0){const a=e.ptrToStr(b);throw Error(a.value)}const f=new Map,h={step(){let a;do e._instance.exports.ade_dialogue_ctx_step(c,o),a=_.StepResult.unmarshal(e,d());while("functionCalled"in a);return a},reset(){e._instance.exports.ade_dialogue_ctx_reset(c)},reply(a){e._instance.exports.ade_dialogue_ctx_reply(c,a)},setCallback(a,m){let u=f.get(a);u===void 0&&(u=e.marshalString(a),f.set(a,u));const y=e._instance.exports.ade_dialogue_ctx_set_callback_js(c,u.ptr,u.len);if(y===0)throw Error("invalid callback handle received, is the dialogue context pointer valid?");L.set(y,m)},setVariableBoolean(a,m){let u=f.get(a);u===void 0&&(u=e.marshalString(a),f.set(a,u)),e._instance.exports.ade_dialogue_ctx_set_variable_boolean(c,u.ptr,u.len,m?1:0)},setVariableString(a,m){let u=f.get(a);u===void 0&&(u=e.marshalString(a),f.set(a,u));let y=f.get(m);y===void 0&&(y=e.marshalString(m),f.set(m,y)),e._instance.exports.ade_dialogue_ctx_set_variable_string(c,u.ptr,u.len,y.ptr,y.len)},dispose(){e._instance.exports.free(o,_.StepResult.byteSize),e._instance.exports.ade_dialogue_ctx_destroy(c);for(const a of f.values())a.free()}};return r.free(),h}const g=new Map,B="onmessage"in globalThis?Promise.resolve(t=>globalThis.onmessage=n=>t(n.data)):import("./__vite-browser-external-dfc062b5.js").then(t=>n=>t.parentPort.on("message",n));B.then(t=>t(async n=>{const e=n.id;try{if(n.type==="makeDialogueContext"){const r=await v(...n.args);g.set(e,r),postMessage({id:e,result:{ptr:e}})}else if(n.type==="DialogueContext.step"){const r=g.get(n.ptr);if(!r)throw Error("no such pointer");postMessage({id:e,result:r.step()})}else if(n.type==="DialogueContext.reset"){const r=g.get(n.ptr);if(!r)throw Error("no such pointer");postMessage({id:e,result:r.reset()})}else if(n.type==="DialogueContext.reply"){const r=g.get(n.ptr);if(!r)throw Error("no such pointer");postMessage({id:e,result:r.reply(...n.args)})}else if(n.type==="DialogueContext.dispose"){const r=g.get(n.ptr);if(!r)throw Error("no such pointer");postMessage({id:e,result:r.dispose()})}else throw Error("unknown message type")}catch(r){postMessage({id:e,error:`${r.message}
${r.stack}`})}}));
