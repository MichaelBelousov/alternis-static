function V(a,t){if(!a)throw Error(t??"AssertionError: condition was falsey")}function U(a){V(a.exports.memory instanceof WebAssembly.Memory),V(typeof a.exports.malloc=="function"),V(typeof a.exports.free=="function")}function D(a,t,n){const r=new Uint8Array(a.exports.memory.buffer.slice(t));let c=0;for(;c<r.byteLength&&r[c]!==0;++c);return w(a,t,c-1,n)}function w(a,t,n,r="utf8"){const c=a.exports.memory.buffer.slice(t,t+n);return{value:new TextDecoder(r).decode(c),ptr:t,len:n,free(){a.exports.free(this.ptr,this.len)}}}function z(a,t){const n=new TextEncoder().encode(t),r=a.exports.malloc(n.byteLength),c=new DataView(a.exports.memory.buffer,r,n.byteLength);for(let s=0;s<n.byteLength;++s)c.setUint8(s,n[s]);return w(a,r,n.byteLength)}function S(a,t,n,r="utf8"){return w(a,t,n,r)}function N(a){return U(a),{_instance:a,ptrToStr:(...t)=>D(a,...t),ptrAndLenToStr:(...t)=>w(a,...t),marshalString:(...t)=>z(a,...t),unmarshalString:(...t)=>S(a,...t),marshalSlice(t){throw Error("unimplemented")},unmarshalSlice(t,n="utf8"){const r=new DataView(a.exports.memory.buffer,t),c=r.getUint32(0,!0),s=r.getUint32(4,!0);return S(a,c,s,n)}}}var v=async(a={},t)=>{let n;if(t.startsWith("data:")){const r=t.replace(/^data:.*?base64,/,"");let c;if(typeof Buffer=="function"&&typeof Buffer.from=="function")c=Buffer.from(r,"base64");else if(typeof atob=="function"){const s=atob(r);c=new Uint8Array(s.length);for(let p=0;p<s.length;p++)c[p]=s.charCodeAt(p)}else throw new Error("Failed to decode base64-encoded data URL, Buffer and atob are not supported");n=await WebAssembly.instantiate(c,a)}else{const r=await fetch(t),c=r.headers.get("Content-Type")||"";if("instantiateStreaming"in WebAssembly&&c.startsWith("application/wasm"))n=await WebAssembly.instantiateStreaming(r,a);else{const s=await r.arrayBuffer();n=await WebAssembly.instantiate(s,a)}}return n.instance},k=a=>v(a,"/app/assets/alternis-ef275f3b.wasm?init"),m;(a=>{const t=s=>({unmarshal(p,e){const i=[],b=e.getUint32(0,!0);if(b===0)return[];const u=e.getUint32(4,!0);for(let h=0;h<u;++h){const d=new DataView(e.buffer,b+h*s.byteSize);i.push(s.unmarshal(p,d))}return i},byteSize:8});let n;(s=>{function p(e,i){const b=i.getUint32(0,!0);if(b===0)return;const u=i.getUint32(4,!0);return S(e._instance,b,u)}s.unmarshal=p,s.byteSize=8})(n=a.StringSlice||(a.StringSlice={}));let r;(s=>{function p(e,i){const b=i.getUint32(0,!0);if(b===0)return;const u=i.getUint32(4,!0),h=[],d=4;for(let y=0;y<u;++y){const o=new DataView(i.buffer,b+y*d);h.push(o.getUint32(0,!0))}return h}s.unmarshal=p,s.byteSize=8})(r=a.USizeSlice||(a.USizeSlice={}));let c;(s=>{function p(e,i){const b=new DataView(i.buffer,i.byteOffset+0*n.byteSize),u=n.unmarshal(e,b);if(u===void 0)throw Error("speaker was null");const h=new DataView(i.buffer,i.byteOffset+1*n.byteSize),d=n.unmarshal(e,h);if(d===void 0)throw Error("text was null");const y=new DataView(i.buffer,i.byteOffset+2*n.byteSize),o=n.unmarshal(e,y);return{speaker:u.value,text:d.value,metadata:o==null?void 0:o.value}}s.unmarshal=p,s.byteSize=3*n.byteSize})(c=a.Line||(a.Line={})),(s=>{(e=>{e[e.Done=0]="Done",e[e.Options=1]="Options",e[e.Line=2]="Line",e[e.FunctionCalled=3]="FunctionCalled"})(s.Tag||(s.Tag={}));function p(e,i){const b=i.getUint8(0);if(b==0)return{done:!0};const u=new DataView(i.buffer,i.byteOffset+4,i.byteLength-4);if(b==1){const h=new DataView(i.buffer,u.byteOffset+0),d=t(c).unmarshal(e,h),y=new DataView(i.buffer,u.byteOffset+t(c).byteSize),o=r.unmarshal(e,y)??[];return{options:d.map((f,l)=>({...f,id:o[l]}))}}if(b==2)return{line:c.unmarshal(e,u)};if(b==3)return{functionCalled:!0};throw Error("unreachable; unknown tag while unmarshalling StepResult")}s.unmarshal=p,s.byteSize=4+Math.max(c.byteSize,t(c).byteSize)})(a.StepResult||(a.StepResult={})),(s=>{(e=>{e[e.NoError=0]="NoError",e[e.OutOfMemory=1]="OutOfMemory",e[e.MissingField=2]="MissingField",e[e.UnexpectedToken=3]="UnexpectedToken",e[e.Overflow=4]="Overflow",e[e.InvalidCharacter=5]="InvalidCharacter",e[e.InvalidNumber=6]="InvalidNumber",e[e.InvalidEnumTag=7]="InvalidEnumTag",e[e.DuplicateField=8]="DuplicateField",e[e.UnknownField=9]="UnknownField",e[e.LengthMismatch=10]="LengthMismatch",e[e.SyntaxError=11]="SyntaxError",e[e.UnexpectedEndOfInput=12]="UnexpectedEndOfInput",e[e.BufferUnderrun=13]="BufferUnderrun",e[e.ValueTooLong=14]="ValueTooLong",e[e.AlternisUnknownVersion=15]="AlternisUnknownVersion",e[e.AlternisBadNextNode=16]="AlternisBadNextNode",e[e.AlternisInvalidNode=17]="AlternisInvalidNode",e[e.AlternisDefaultSeedUnsupportedPlatform=18]="AlternisDefaultSeedUnsupportedPlatform"})(s.Errors||(s.Errors={}));function p(e,i){const b=new DataView(i.buffer,i.byteOffset+8,n.byteSize),u=i.getInt32(4),h=u===0?{value:""}:n.unmarshal(e,b);return{errorCode:u,errorMessage:h.value,free(){M().then(d=>d._instance.exports.ade_diagnostic_destroy(i.byteOffset))}}}s.unmarshal=p,s.byteSize=4+4+n.byteSize})(a.Diagnostic||(a.Diagnostic={}))})(m||(m={}));let T,A;const L=new Map;async function M(){return T??(T=k({env:{_debug_print(a,t){console.log(S(A,a,t).value)},_call_js(a){const t=L.get(a);if(t===void 0)throw Error("no such handle!");t()}}}).then(a=>(A=a,N(a))))}function B(a){for(let t=0;t<a.byteLength;t+=4)a.setUint32(t,0)}async function C(a,t={}){const n=await M(),r=n.marshalString(a),c=t.randomSeed??BigInt(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)),s=t.noInterpolate??!1?1:0,p=n._instance.exports.malloc(m.Diagnostic.byteSize),e=()=>new DataView(n._instance.exports.memory.buffer,p,m.Diagnostic.byteSize);B(e());const i=n._instance.exports.malloc(m.StepResult.byteSize),b=()=>new DataView(n._instance.exports.memory.buffer,i),u=n._instance.exports.ade_dialogue_ctx_create_json(r.ptr,r.len,c,s,p),h=m.Diagnostic.unmarshal(n,e());try{if(h.errorCode!==0){const f=m.Diagnostic.unmarshal(n,e()).errorMessage;throw new Error(f)}}finally{h.free()}const d=new Map,y={step(o){var g;let f;const l=((g=globalThis==null?void 0:globalThis.__alternis)==null?void 0:g.MAX_STEP_ITERS)??5e5;if(l<=0)throw Error(`invalid globalThis.__alternis.MAX_STEP_ITERS of '${l}'`);for(let x=0;x<l&&(n._instance.exports.ade_dialogue_ctx_step(u,o,i),f=m.StepResult.unmarshal(n,b()),"functionCalled"in f);++x);return f},reset(o,f=0){n._instance.exports.ade_dialogue_ctx_reset(u,o,f)},reply(o,f){n._instance.exports.ade_dialogue_ctx_reply(u,o,f)},getNodeByLabel(o,f){let l=d.get(f);return l===void 0&&(l=n.marshalString(f),d.set(f,l)),n._instance.exports.ade_dialogue_ctx_get_node_by_label(u,o,l.ptr,l.len)},setCallback(o,f){let l=d.get(o);l===void 0&&(l=n.marshalString(o),d.set(o,l));const g=n._instance.exports.ade_dialogue_ctx_set_callback_js(u,l.ptr,l.len);if(g===0)throw Error("invalid callback handle received, is the dialogue context pointer valid?");L.set(g,f)},setVariableBoolean(o,f){let l=d.get(o);l===void 0&&(l=n.marshalString(o),d.set(o,l)),n._instance.exports.ade_dialogue_ctx_set_variable_boolean(u,l.ptr,l.len,f?1:0)},setVariableString(o,f){let l=d.get(o);l===void 0&&(l=n.marshalString(o),d.set(o,l));let g=d.get(f);g===void 0&&(g=n.marshalString(f),d.set(f,g)),n._instance.exports.ade_dialogue_ctx_set_variable_string(u,l.ptr,l.len,g.ptr,g.len)},dispose(){n._instance.exports.free(i,m.StepResult.byteSize),n._instance.exports.ade_dialogue_ctx_destroy(u);for(const o of d.values())o.free()}};return r.free(),y}const _=new Map,O="onmessage"in globalThis?Promise.resolve(a=>globalThis.onmessage=t=>a(t.data)):import("./__vite-browser-external-dfc062b5.js").then(a=>t=>a.parentPort.on("message",t));O.then(a=>a(async t=>{const n=t.id;try{if(t.type==="makeDialogueContext"){const r=await C(...t.args);_.set(n,r),postMessage({id:n,result:{ptr:n}})}else if(t.type==="DialogueContext.step"){const r=_.get(t.ptr);if(!r)throw Error("no such pointer");postMessage({id:n,result:r.step(...t.args)})}else if(t.type==="DialogueContext.reset"){const r=_.get(t.ptr);if(!r)throw Error("no such pointer");postMessage({id:n,result:r.reset(...t.args)})}else if(t.type==="DialogueContext.reply"){const r=_.get(t.ptr);if(!r)throw Error("no such pointer");postMessage({id:n,result:r.reply(...t.args)})}else if(t.type==="DialogueContext.getNodeByLabel"){const r=_.get(t.ptr);if(!r)throw Error("no such pointer");postMessage({id:n,result:r.getNodeByLabel(...t.args)})}else if(t.type==="DialogueContext.dispose"){const r=_.get(t.ptr);if(!r)throw Error("no such pointer");postMessage({id:n,result:r.dispose()})}else throw Error("unknown message type")}catch(r){postMessage({id:n,error:`${r.message}
${r.stack}`})}}));
